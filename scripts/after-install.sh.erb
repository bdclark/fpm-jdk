#!/bin/sh
set -e

JAVA_HOME=<%= prefix %>
JRE_BIN=$JAVA_HOME/jre/bin
JDK_BIN=$JAVA_HOME/bin
MAN_DIR=/usr/share/man/man1
JAVA_MAN=$JAVA_HOME/man/man1

# openjdk uses version to determine priority, where 170065 is 1.7.0.65
# we want this to have a higher priority so we're starting with 27000
PRIORITY=<%= version.to_i + 270_000 %>

mkdir -p /usr/lib/jvm /usr/lib/jvm-exports

update-alternatives --install /usr/bin/java java $JRE_BIN/java $PRIORITY \
--slave /usr/lib/jvm/jre         jre           $JAVA_HOME/jre \
--slave /usr/lib/jvm-exports/jre jre_exports   $JAVA_HOME/jre/lib \
--slave /usr/bin/keytool         keytool       $JRE_BIN/keytool \
--slave /usr/bin/orbd            orbd          $JRE_BIN/orbd \
--slave /usr/bin/pack200         pack200       $JRE_BIN/pack200 \
--slave /usr/bin/rmid            rmid          $JRE_BIN/rmid \
--slave /usr/bin/rmiregistry     rmiregistry   $JRE_BIN/rmiregistry \
--slave /usr/bin/servertool      servertool    $JRE_BIN/servertool \
--slave /usr/bin/tnameserv       tnameserv     $JRE_BIN/tnameserv \
--slave /usr/bin/unpack200       unpack200     $JRE_BIN/unpack200 \
--slave $MAN_DIR/java.1          java.1        $JAVA_MAN/java.1 \
--slave $MAN_DIR/keytool.1       keytool.1     $JAVA_MAN/keytool.1 \
--slave $MAN_DIR/orbd.1          orbd.1        $JAVA_MAN/orbd.1 \
--slave $MAN_DIR/pack200.1       pack200.1     $JAVA_MAN/pack200.1 \
--slave $MAN_DIR/rmid.1.gz       rmid.1        $JAVA_MAN/rmid.1 \
--slave $MAN_DIR/rmiregistry.1   rmiregistry.1 $JAVA_MAN/rmiregistry.1 \
--slave $MAN_DIR/servertool.1    servertool.1  $JAVA_MAN/servertool.1 \
--slave $MAN_DIR/tnameserv.1     tnameserv.1   $JAVA_MAN/tnameserv.1 \
--slave $MAN_DIR/unpack200.1     unpack200.1   $JAVA_MAN/unpack200.1

update-alternatives --install \
  /usr/lib/jvm/jre-1.7.0 jre_1.7.0 $JAVA_HOME/jre $PRIORITY \
  --slave /usr/lib/jvm-exports/jre-1.7.0 jre_1.7.0_exports $JAVA_HOME/jre/lib

update-alternatives --install /usr/bin/javac javac $JDK_BIN/javac $PRIORITY \
--slave /usr/lib/jvm/java         java_sdk          $JAVA_HOME \
--slave /usr/lib/jvm-exports/java java_sdk_exports  $JAVA_HOME/lib \
--slave /usr/bin/appletviewer     appletviewer      $JDK_BIN/appletviewer \
--slave /usr/bin/apt              apt               $JDK_BIN/apt \
--slave /usr/bin/extcheck         extcheck          $JDK_BIN/extcheck \
--slave /usr/bin/idlj             idlj              $JDK_BIN/idlj \
--slave /usr/bin/jar              jar               $JDK_BIN/jar \
--slave /usr/bin/jarsigner        jarsigner         $JDK_BIN/jarsigner \
--slave /usr/bin/javadoc          javadoc           $JDK_BIN/javadoc \
--slave /usr/bin/javah            javah             $JDK_BIN/javah \
--slave /usr/bin/javap            javap             $JDK_BIN/javap \
--slave /usr/bin/javaws           javaws            $JDK_BIN/javaws \
--slave /usr/bin/jcmd             jcmd              $JDK_BIN/jcmd \
--slave /usr/bin/jconsole         jconsole          $JDK_BIN/jconsole \
--slave /usr/bin/jdb              jdb               $JDK_BIN/jdb \
--slave /usr/bin/jhat             jhat              $JDK_BIN/jhat \
--slave /usr/bin/jinfo            jinfo             $JDK_BIN/jinfo \
--slave /usr/bin/jmap             jmap              $JDK_BIN/jmap \
--slave /usr/bin/jps              jps               $JDK_BIN/jps \
--slave /usr/bin/jrunscript       jrunscript        $JDK_BIN/jrunscript \
--slave /usr/bin/jsadebugd        jsadebugd         $JDK_BIN/jsadebugd \
--slave /usr/bin/jstack           jstack            $JDK_BIN/jstack \
--slave /usr/bin/jstat            jstat             $JDK_BIN/jstat \
--slave /usr/bin/jstatd           jstatd            $JDK_BIN/jstatd \
--slave /usr/bin/native2ascii     native2ascii      $JDK_BIN/native2ascii \
--slave /usr/bin/policytool       policytool        $JDK_BIN/policytool \
--slave /usr/bin/rmic             rmic              $JDK_BIN/rmic \
--slave /usr/bin/schemagen        schemagen         $JDK_BIN/schemagen \
--slave /usr/bin/serialver        serialver         $JDK_BIN/serialver \
--slave /usr/bin/wsgen            wsgen             $JDK_BIN/wsgen \
--slave /usr/bin/wsimport         wsimport          $JDK_BIN/wsimport \
--slave /usr/bin/xjc              xjc               $JDK_BIN/xjc \
--slave $MAN_DIR/appletviewer.1   appletviewer.1    $JAVA_MAN/appletviewer.1 \
--slave $MAN_DIR/apt.1            apt.1             $JAVA_MAN/apt.1 \
--slave $MAN_DIR/extcheck.1       extcheck.1        $JAVA_MAN/extcheck.1 \
--slave $MAN_DIR/jar.1            jar.1             $JAVA_MAN/jar.1 \
--slave $MAN_DIR/jarsigner.1      jarsigner.1       $JAVA_MAN/jarsigner.1 \
--slave $MAN_DIR/javac.1          javac.1           $JAVA_MAN/javac.1 \
--slave $MAN_DIR/javadoc.1        javadoc.1         $JAVA_MAN/javadoc.1 \
--slave $MAN_DIR/javah.1          javah.1           $JAVA_MAN/javah.1 \
--slave $MAN_DIR/javap.1          javap.1           $JAVA_MAN/javap.1 \
--slave $MAN_DIR/javaws.1         javaws.1          $JAVA_MAN/javaws.1 \
--slave $MAN_DIR/jcmd.1           jcmd.1            $JAVA_MAN/jcmd.1 \
--slave $MAN_DIR/jconsole.1       jconsole.1        $JAVA_MAN/jconsole.1 \
--slave $MAN_DIR/jdb.1            jdb.1             $JAVA_MAN/jdb.1 \
--slave $MAN_DIR/jhat.1           jhat.1            $JAVA_MAN/jhat.1 \
--slave $MAN_DIR/jinfo.1          jinfo.1           $JAVA_MAN/jinfo.1 \
--slave $MAN_DIR/jmap.1           jmap.1            $JAVA_MAN/jmap.1 \
--slave $MAN_DIR/jps.1            jps.1             $JAVA_MAN/jps.1 \
--slave $MAN_DIR/jrunscript.1     jrunscript.1      $JAVA_MAN/jrunscript.1 \
--slave $MAN_DIR/jsadebugd.1      jsadebugd.1       $JAVA_MAN/jsadebugd.1 \
--slave $MAN_DIR/jstack.1         jstack.1          $JAVA_MAN/jstack.1 \
--slave $MAN_DIR/jstat.1          jstat.1           $JAVA_MAN/jstat.1 \
--slave $MAN_DIR/jstatd.1         jstatd.1          $JAVA_MAN/jstatd.1 \
--slave $MAN_DIR/native2ascii.1   native2ascii.1    $JAVA_MAN/native2ascii.1 \
--slave $MAN_DIR/policytool.1     policytool.1      $JAVA_MAN/policytool.1 \
--slave $MAN_DIR/rmic.1           rmic.1            $JAVA_MAN/rmic.1 \
--slave $MAN_DIR/schemagen.1      schemagen.1       $JAVA_MAN/schemagen.1 \
--slave $MAN_DIR/serialver.1      serialver.1       $JAVA_MAN/serialver.1 \
--slave $MAN_DIR/wsgen.1          wsgen.1           $JAVA_MAN/wsgen.1 \
--slave $MAN_DIR/wsimport.1       wsimport.1        $JAVA_MAN/wsimport.1 \
--slave $MAN_DIR/xjc.1            xjc.1             $JAVA_MAN/xjc.1

update-alternatives --install \
  /usr/lib/jvm/java-1.7.0 java_sdk_1.7.0 $JAVA_HOME $PRIORITY \
  --slave /usr/lib/jvm-exports/java-1.7.0 java_sdk_1.7.0_exports $JAVA_HOME/lib

exit 0
